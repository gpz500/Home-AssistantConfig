# Configure a default setup of Home Assistant (frontend, api, etc)
default_config:

# Uncomment this if you are using SSL/TLS, running in Docker container, etc.
http:
  base_url: !secret http_base_url
  ssl_certificate: !secret http_ssl_certificate
  ssl_key: !secret http_ssl_key

# Text to speech
tts:
  - platform: google_translate
    language: 'it'

group: !include groups.yaml
automation: !include automations.yaml
script: !include scripts.yaml
homeassistant:
  customize: !include customize.yaml
  customize_glob:
    "device_tracker.gpz500*":
      hidden: true

# Netatmo
netatmo:
  api_key: !secret netatmo_api_key
  secret_key: !secret netatmo_secret_key
  username: !secret netatmo_username
  password: !secret netatmo_password

# Discovery integration
discovery:

# iOS integration
ios:

# Device tracker
device_tracker:
  - platform: fritz
    host: fritz.box

# Define some zone
zone:
  - name: Work
    latitude: !secret work_latitude
    longitude: !secret work_longitude
    icon: mdi:worker

# MQTT
mqtt:
  broker: localhost
  client_id: home-assistant
  birth_message:
    topic: 'hass/status'
    payload: 'online'
    qos: 0
    retain: true
  will_message:
    topic: 'hass/status'
    payload: 'offline'
    qos: 0
    retain: true

# I miei switch
switch:
  - platform: mqtt
    name: "ModelOne Switch"
    state_topic: "shellies/shellyplug-s-040FF2/relay/0"
    command_topic: "shellies/shellyplug-s-040FF2/relay/0/command"
    availability_topic: "shellies/shellyplug-s-040FF2/online"
    payload_on: "on"
    payload_off: "off"
    state_on: "on"
    state_off: "off"
    payload_available: "true"
    payload_not_available: "false"
    optimistic: false
    qos: 0
    retain: false
  - platform: mqtt
    name: "Piantana"
    state_topic: "stat/piantana01/POWER"
    command_topic: "cmnd/piantana01/POWER"
    availability_topic: "tele/piantana01/LWT"
    payload_on: "ON"
    payload_off: "OFF"
    state_on: "ON"
    state_off: "OFF"
    payload_available: "Online"
    payload_not_available: "Offline"
    optimistic: false
    qos: 0
    retain: false
  - platform: mqtt
    name: "Lampada TV"
    state_topic: "stat/lampadatv/POWER"
    command_topic: "cmnd/lampadatv/POWER"
    availability_topic: "tele/lampadatv/LWT"
    payload_on: "ON"
    payload_off: "OFF"
    state_on: "ON"
    state_off: "OFF"
    payload_available: "Online"
    payload_not_available: "Offline"
    optimistic: false
    qos: 0
    retain: false
  - platform: mqtt
    name: "Presa piantana"
    state_topic: "stat/ferrodastiro/POWER"
    command_topic: "cmnd/ferrodastiro/POWER"
    availability_topic: "tele/ferrodastiro/LWT"
    payload_on: "ON"
    payload_off: "OFF"
    state_on: "ON"
    state_off: "OFF"
    payload_available: "Online"
    payload_not_available: "Offline"
    optimistic: false
    qos: 0
    retain: false
  - platform: "mqtt"
    name: "Ferro da stiro"
    state_topic: "zigbee2mqtt/tradfri_plug_1"
    availability_topic: "zigbee2mqtt/bridge/state"
    payload_off: "OFF"
    payload_on: "ON"
    value_template: "{{ value_json.state }}"
    command_topic: "zigbee2mqtt/tradfri_plug_1/set"

# I miei sensori
sensor:
  - platform: mqtt
    state_topic: "shellies/shellyplug-s-040FF2/relay/0/power"
    availability_topic: "shellies/shellyplug-s-040FF2/online"
    device_class: power
    name: "ModelOne Power"
    unit_of_measurement: "W"
    payload_available: "true"
    payload_not_available: "false"
  - platform: mqtt
    state_topic: "shellies/shellyplug-s-040FF2/temperature"
    availability_topic: "shellies/shellyplug-s-040FF2/online"
    device_class: temperature
    unit_of_measurement: "Â°C"
    name: "ModelOne Temperature"
    payload_available: "true"
    payload_not_available: "false"
  - platform: cert_expiry
    host: !secret cert_expiry_host
  - platform: "mqtt"
    state_topic: "zigbee2mqtt/tradfri_light_1"
    availability_topic: "zigbee2mqtt/bridge/state"
    unit_of_measurement: "-"
    value_template: "{{ value_json.linkquality }}"
    name: "Tradfri Light 1"
  - platform: "mqtt"
    state_topic: "zigbee2mqtt/tradfri_light_2"
    availability_topic: "zigbee2mqtt/bridge/state"
    unit_of_measurement: "-"
    value_template: "{{ value_json.linkquality }}"
    name: "Tradfri Light 2"
  - platform: "mqtt"
    state_topic: "zigbee2mqtt/tradfri_light_3"
    availability_topic: "zigbee2mqtt/bridge/state"
    unit_of_measurement: "-"
    value_template: "{{ value_json.linkquality }}"
    name: "Tradfri Light 3"
  - platform: "mqtt"
    state_topic: "zigbee2mqtt/tradfri_dimmer_1"
    availability_topic: "zigbee2mqtt/bridge/state"
    unit_of_measurement: "brightness"
    icon: "mdi:brightness-5"
    value_template: "{{ value_json.brightness }}"
    name: "Tradfri Dimmer 1"
  - platform: "mqtt"
    state_topic: "zigbee2mqtt/tradfri_dimmer_1"
    availability_topic: "zigbee2mqtt/bridge/state"
    unit_of_measurement: "%"
    device_class: "battery"
    value_template: "{{ value_json.battery }}"
    name: "Tradfri Dimmer 1 - Battery"
  - platform: "mqtt"
    state_topic: "zigbee2mqtt/tradfri_dimmer_1"
    availability_topic: "zigbee2mqtt/bridge/state"
    icon: "mdi:gesture-double-tap"
    value_template: "{{ value_json.action }}"
  - platform: "mqtt"
    state_topic: "zigbee2mqtt/tradfri_dimmer_1"
    availability_topic: "zigbee2mqtt/bridge/state"
    unit_of_measurement: "-"
    value_template: "{{ value_json.linkquality }}"
  - platform: mqtt
    name: Zigbee2mqtt Networkmap
    # if you change base_topic of Zigbee2mqtt, change state_topic accordingly
    state_topic: zigbee2mqtt/bridge/networkmap/raw
    value_template: >-
      {{ now().strftime('%Y-%m-%d %H:%M:%S') }}
    # again, if you change base_topic of Zigbee2mqtt, change json_attributes_topic accordingly
    json_attributes_topic: zigbee2mqtt/bridge/networkmap/raw
  - platform: "mqtt"
    name: "Ferro da stiro"
    state_topic: "zigbee2mqtt/tradfri_plug_1"
    availability_topic: "zigbee2mqtt/bridge/state"
    unit_of_measurement: "-"
    value_template: "{{ value_json.linkquality }}"
  - platform: "mqtt"
    state_topic: "zigbee2mqtt/tradfri_button_1"
    availability_topic: "zigbee2mqtt/bridge/state"
    icon: "mdi:toggle-switch"
    value_template: "{{ value_json.click }}"
    name: Tradfri Button 1
  - platform: "mqtt"
    state_topic: "zigbee2mqtt/tradfri_button_1"
    availability_topic: "zigbee2mqtt/bridge/state"
    unit_of_measurement: "%"
    device_class: "battery"
    value_template: "{{ value_json.battery }}"
  - platform: "mqtt"
    state_topic: "zigbee2mqtttradfri_button_1"
    availability_topic: "zigbee2mqtt/bridge/state"
    unit_of_measurement: "-"
    value_template: "{{ value_json.linkquality }}"

binary_sensor:
  - platform: template
    sensors:
      riscaldamento_on:
        friendly_name: "Riscaldamento On"
        value_template: >-
          {{ is_state('climate.netatmo_living_room', 'heat') }}
      riscaldamento_off:
        friendly_name: "Riscaldamento Off"
        value_template: >-
          {{ is_state('climate.netatmo_living_room', 'off') }}
      riscaldamento_auto:
        friendly_name: "Riscaldamento Auto"
        value_template: >-
          {{ is_state('climate.netatmo_living_room', 'auto') }}
      volumio_playing:
        friendly_name: "Volumio sta riproducendo"
        value_template: >-
          {{ is_state('media_player.volumio', 'playing') or is_state('media_player.volumio_mpd', 'playing') or is_state('media_player.volumio_volumio_local', 'playing') }}


# Controllo per il riscaldamento
input_select:
  riscaldamento:
    name: Riscaldamento
    options:
      - 'Off'
      - 'Auto'
      - 'On'

# Interfaccia MPD per Volumio
media_player:
  - platform: mpd
    host: volumio.fritz.box
    name: volumio_mpd

# Le mie scene
scene:
  - name: Tutto spento
    entities:
      switch.ferro_da_stiro: off
      switch.lampada_tv: off
      switch.modelone_switch: off
      switch.piantana: off

# HomeKit
homekit:
  filter:
    include_entities:
      - switch.lampada_tv
      - switch.piantana
      - switch.ferro_da_stiro
      - switch.modelone_switch
      - switch.presa_piantana
      - light.tradfri_light_1

# Qualche timer
timer:
  lucialbero:
    name: 'Luci albero di Natale'

# Impostazioni di registrazione sul DB
recorder:
  exclude:
    entities:
      - sensor.fritz_box_3490_bytes_received
      - sensor.fritz_box_3490_bytes_sent
      - sensor.fritz_box_3490_kb_sec_received
      - sensor.fritz_box_3490_kb_sec_sent
      - sensor.fritz_box_3490_packets_received
      - sensor.fritz_box_3490_packets_sent
      - sensor.fritz_box_3490_packets_sec_received
      - sensor.fritz_box_3490_packets_sec_sent

# Le mie luci
light:
  - platform: "mqtt"
    state_topic: "zigbee2mqtt/tradfri_light_1"
    availability_topic: "zigbee2mqtt/bridge/state"
    brightness: true
    color_temp: true
    schema: "json"
    command_topic: "zigbee2mqtt/tradfri_light_1/set"
    name: "Tradfri Light 1"
  - platform: "mqtt"
    state_topic: "zigbee2mqtt/tradfri_light_2"
    availability_topic: "zigbee2mqtt/bridge/state"
    brightness: true
    color_temp: true
    schema: "json"
    command_topic: "zigbee2mqtt/tradfri_light_2/set"
    name: "Tradfri Light 2"
  - platform: "mqtt"
    state_topic: "zigbee2mqtt/tradfri_light_3"
    availability_topic: "zigbee2mqtt/bridge/state"
    brightness: true
    color_temp: true
    schema: "json"
    command_topic: "zigbee2mqtt/tradfri_light_3/set"
    name: "Tradfri Light 3"
